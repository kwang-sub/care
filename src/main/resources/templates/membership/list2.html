<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/layout :: setContent(~{this::content})}">
    <th:block th:fragment="content">
        <section class="feature_product_area section_gap_bottom_custom">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="main_title">
                            <h2><span>MEMBERSHIP SERVICE</span></h2>
                            <p>Bring called seed first of third give itself now ment</p>
                        </div>
                    </div>
                </div>
                <div  class="row">
                    <div th:each="membership : ${membershipList}" class="col-lg-4 col-md-6">
                        <div class="single-product">
                            <div class="product-img">
                                <img class="img-fluid w-100" src="img/product/feature-product/f-p-1.jpg" alt="" />
                                <div class="p_icon">
                                    카카오페이 간편결제
                                    <a class="pay-button">
                                        <i class="ti-credit-card"></i>
                                        <input type="hidden" id="grade" name="grade" th:value="${membership.grade}">
                                        <input type="hidden" id="price" name="price" th:value="${membership.price}">
                                    </a>

                                </div>
                            </div>
                            <div class="product-btm">
                                <div>
                                    <a href="#" class="d-block">
                                        <h1 style="color: #4ABF60" th:text="${membership.grade}">등급</h1>
                                    </a>
                                </div>
                                <span th:text="'$'+${#numbers.formatInteger(membership.price, 3, 'COMMA') + '/'}" th:fo>가격</span><sub style="color: black">월</sub>
                            </div>
                            <ul th:each="detail, index : ${membership.membershipDetailDTOs}" class="list-group">
                                <li class="list-group-item" th:text="|${detail.title} ${detail.number}회|"></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!--모달 창-->
        <div class="modal fade" id="map-modal" role="map" aria-labelledby="map"
             aria-hidden="true" tabindex="-1">
            <!--modal-dailog : 모달 창 영역 설정-->
            <div class="modal-dialog">
                <!--modal-content : 모달 창 콘텐츠 영역 설정-->
                <div class="modal-content">
                    <!--modal-header : 모달 창 콘텐츠의 헤더영역-->
                    <div class="modal-header modal-header-custom">
                        <h4 class="modal-title modal-title-custom">지도</h4>
                    </div>
                    <!--modal-body : 모달 창 콘텐츠의 바디영역-->
                    <div class="modal-body" id="map-body">
                        <!-- iframe src="/map?id={id}" -->
                        <iframe id="go-map" ></iframe>
                    </div>
                    <!--modal-footer : 모달 창 콘텐츠의 푸터영역-->
                    <div class="modal-footer">
                        <div class="modal-footer-custom">
                            <button type="button" class="btn btn-primary">형민님</button>
                            <button type="button" class="btn btn-danger"
                                    data-bs-dismiss="modal">
                                닫기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</th:block>
<script type="text/javascript" src="/js/kakao.js"></script>
<script th:inline="javascript">
    $(document).ready(function () {
        $('.pay-button').click(this, function () {
            var priceNode = this.lastChild;
            var gradeNode = priceNode.previousSibling;
            var grade = gradeNode.previousElementSibling.defaultValue;
            var price = priceNode.previousElementSibling.defaultValue;

            $.post("/pay/kakao", {
                grade: grade,
                price: price
            }, function (data, status) {
                url = data.next_redirect_pc_url;
                window.open(url);

            });
        });
    });
</script>
</html>